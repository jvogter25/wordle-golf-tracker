(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{6837:function(e,t,r){Promise.resolve().then(r.bind(r,5483))},5483:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return SubmitPage}});var s=r(7437),a=r(2265),n=r(1396),i=r.n(n),l=r(1344),o=r(2899);function SubmitPage(){let{user:e,loading:t}=(0,l.useAuth)(),[r,n]=(0,a.useState)([]),[c,u]=(0,a.useState)(""),[d,m]=(0,a.useState)(""),[h,g]=(0,a.useState)(!1),[x,p]=(0,a.useState)("");(0,a.useEffect)(()=>{e&&fetchUserGroups()},[e]);let fetchUserGroups=async()=>{try{let{data:t,error:r}=await o.OQ.from("group_members").select("groups(*)").eq("user_id",null==e?void 0:e.id);if(r)throw r;let s=t.map(e=>e.groups).filter(Boolean);n(s),1===s.length&&u(s[0].id)}catch(e){console.error("Error fetching groups:",e)}},getGolfScore=e=>{switch(e){case 1:return{score:"Hole in One",rawScore:-3};case 2:return{score:"Eagle",rawScore:-2};case 3:return{score:"Birdie",rawScore:-1};case 4:return{score:"Par",rawScore:0};case 5:return{score:"Bogey",rawScore:1};case 6:return{score:"Double Bogey",rawScore:2};case 7:return{score:"Failed (7 attempts)",rawScore:7};default:return{score:"Invalid",rawScore:10}}},getTodaysPuzzleDate=()=>{let e=new Date,t=new Date(e.toLocaleString("en-US",{timeZone:"America/Los_Angeles"}));return t.toISOString().split("T")[0]},submitScore=async t=>{if(t.preventDefault(),!c||!d){p("Please select a group and enter your attempts");return}let r=parseInt(d);if(r<1||r>7){p("Attempts must be between 1 and 7");return}g(!0),p("");try{let t=getTodaysPuzzleDate(),{score:s,rawScore:a}=getGolfScore(r),{data:n}=await o.OQ.from("scores").select("*").eq("user_id",null==e?void 0:e.id).eq("group_id",c).eq("puzzle_date",t).single();if(n){p("You have already submitted a score for today in this group"),g(!1);return}let{error:i}=await o.OQ.from("scores").insert({user_id:null==e?void 0:e.id,group_id:c,puzzle_date:t,attempts:r,golf_score:s,raw_score:a});if(i)throw i;p("Score submitted! You got a ".concat(s," (").concat(a>0?"+":"").concat(a,")")),m("")}catch(e){p("Error submitting score: ".concat(e.message))}finally{g(!1)}};return t?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Submit Today's Score"}),(0,s.jsx)("p",{className:"text-gray-600",children:"How many attempts did your Wordle take?"})]}),x&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-lg text-center ".concat(x.includes("Error")?"bg-red-50 text-red-700":"bg-green-50 text-green-700"),children:x}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,s.jsxs)("form",{onSubmit:submitScore,className:"space-y-6",children:[r.length>1&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Group"}),(0,s.jsxs)("select",{value:c,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Choose a group..."}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Attempts"}),(0,s.jsxs)("select",{value:d,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-lg",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select attempts..."}),(0,s.jsx)("option",{value:"1",children:"1 attempt - Hole in One! \uD83C\uDFC6"}),(0,s.jsx)("option",{value:"2",children:"2 attempts - Eagle \uD83E\uDD85"}),(0,s.jsx)("option",{value:"3",children:"3 attempts - Birdie \uD83D\uDC26"}),(0,s.jsx)("option",{value:"4",children:"4 attempts - Par ⭐"}),(0,s.jsx)("option",{value:"5",children:"5 attempts - Bogey \uD83D\uDE10"}),(0,s.jsx)("option",{value:"6",children:"6 attempts - Double Bogey \uD83D\uDE2C"}),(0,s.jsx)("option",{value:"7",children:"Failed (7 attempts) ❌"})]})]}),d&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-900 mb-1",children:"Golf Score Preview:"}),(0,s.jsx)("p",{className:"text-blue-700 text-lg",children:(()=>{let e=parseInt(d);if(e>=1&&e<=7){let{score:t,rawScore:r}=getGolfScore(e);return"".concat(t," (").concat(r>0?"+":"").concat(r,")")}return""})()})]}),(0,s.jsx)("button",{type:"submit",disabled:h||!c||!d,className:"w-full bg-primary-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-primary-600 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:h?"Submitting...":"Submit Score"})]}),(0,s.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Golf Scoring Guide:"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,s.jsx)("div",{children:"1 attempt = Hole in One (-3)"}),(0,s.jsx)("div",{children:"2 attempts = Eagle (-2)"}),(0,s.jsx)("div",{children:"3 attempts = Birdie (-1)"}),(0,s.jsx)("div",{children:"4 attempts = Par (0)"}),(0,s.jsx)("div",{children:"5 attempts = Bogey (+1)"}),(0,s.jsx)("div",{children:"6 attempts = Double Bogey (+2)"}),(0,s.jsx)("div",{children:"Failed = +7 penalty"})]})]})]}),(0,s.jsxs)("div",{className:"mt-8 text-center space-x-4",children:[(0,s.jsx)(i(),{href:"/groups",className:"text-primary-500 hover:text-primary-600",children:"← Back to Groups"}),(0,s.jsx)(i(),{href:"/leaderboard",className:"text-primary-500 hover:text-primary-600",children:"View Leaderboard →"})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in"}),(0,s.jsx)(i(),{href:"/auth/login",className:"bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600",children:"Sign In"})]})})}},1344:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var s=r(7437),a=r(2265),n=r(2899);let i=(0,a.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[m,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{h(!0)},[]),(0,a.useEffect)(()=>{if(!m)return;n.OQ.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;c(r),l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),d(!1)});let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{var r;c(t),l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),d(!1)}),t=setInterval(async()=>{let e=await (0,n.eR)();e.isValid&&e.timeUntilExpiry<216e5&&(console.log("Refreshing session automatically..."),await (0,n.dx)())},432e5);return()=>{e.unsubscribe(),clearInterval(t)}},[m]);let signOut=async()=>{try{await n.OQ.auth.signOut()}catch(e){console.error("Error signing out:",e)}};return m?(0,s.jsx)(i.Provider,{value:{user:r,session:o,loading:u,signOut},children:t}):(0,s.jsx)("div",{className:"min-h-screen bg-blue-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl text-gray-600",children:"Loading..."})})}let useAuth=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2899:function(e,t,r){"use strict";r.d(t,{OQ:function(){return l},dx:function(){return refreshSession},eR:function(){return getSessionStatus}});var s=r(2362),a=r(2601);let n=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://xneavnttdgrpltmmldit.supabase.co",i=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZWF2bnR0ZGdycGx0bW1sZGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTk3ODksImV4cCI6MjA2NTIzNTc4OX0.2T3VMVWWn7g-m8iYcoHq8r5ZkM8rWtLEZ2RXWttw3AA";if(!n||!i)throw Error("Missing Supabase environment variables");let l=(0,s.eI)(n,i,{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"wordle-golf-session",flowType:"pkce"},global:{headers:{"X-Client-Info":"wordle-golf-tracker"}}}),refreshSession=async()=>{try{let{data:e,error:t}=await l.auth.refreshSession();if(t)return console.log("Session refresh error:",t.message),!1;return!0}catch(e){return console.log("Session refresh failed:",e),!1}},getSessionStatus=async()=>{try{let{data:{session:e}}=await l.auth.getSession();return{isValid:!!e,expiresAt:null==e?void 0:e.expires_at,refreshToken:null==e?void 0:e.refresh_token,timeUntilExpiry:(null==e?void 0:e.expires_at)?1e3*e.expires_at-Date.now():0}}catch(e){return{isValid:!1,expiresAt:null,refreshToken:null,timeUntilExpiry:0}}}},1396:function(e,t,r){e.exports=r(8326)}},function(e){e.O(0,[553,326,971,472,744],function(){return e(e.s=6837)}),_N_E=e.O()}]);