(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[586],{4192:function(e,t,r){Promise.resolve().then(r.bind(r,1488))},1488:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return GroupsPage}});var s=r(7437),a=r(2265),i=r(1396),n=r.n(i),l=r(1344),o=r(2899);function GroupsPage(){let{user:e,loading:t}=(0,l.useAuth)(),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(""),[N,w]=(0,a.useState)("");(0,a.useEffect)(()=>{e&&fetchGroups()},[e]);let fetchGroups=async()=>{try{let{data:t,error:r}=await o.OQ.from("group_members").select("\n          groups (\n            id,\n            name,\n            description,\n            created_by,\n            created_at,\n            invite_code\n          )\n        ").eq("user_id",null==e?void 0:e.id);if(r)throw r;let s=await Promise.all(t.map(async e=>{let t=e.groups,{count:r}=await o.OQ.from("group_members").select("*",{count:"exact",head:!0}).eq("group_id",t.id);return{...t,member_count:r||0}}));c(s)}catch(e){w("Error loading groups")}finally{u(!1)}},createGroup=async e=>{if(e.preventDefault(),p.trim())try{let{createGroup:e}=await r.e(270).then(r.bind(r,8270));await e(p.trim(),b.trim()||void 0),w("Group created successfully!"),x(!1),f(""),y(""),fetchGroups()}catch(e){w("Error creating group: ".concat(e.message))}},joinGroup=async t=>{if(t.preventDefault(),v.trim())try{let{data:t,error:r}=await o.OQ.from("groups").select("*").eq("invite_code",v.trim().toUpperCase()).single();if(r||!t){w("Invalid invite code");return}let{data:s}=await o.OQ.from("group_members").select("*").eq("group_id",t.id).eq("user_id",null==e?void 0:e.id).single();if(s){w("You are already a member of this group");return}let{error:a}=await o.OQ.from("group_members").insert({group_id:t.id,user_id:null==e?void 0:e.id,role:"member"});if(a)throw a;w("Successfully joined group!"),h(!1),j(""),fetchGroups()}catch(e){w("Error joining group: ".concat(e.message))}};return t||d?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading groups..."})]})}):e?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Groups"}),(0,s.jsxs)("div",{className:"space-x-4",children:[(0,s.jsx)("button",{onClick:()=>h(!0),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:"Join Group"}),(0,s.jsx)("button",{onClick:()=>x(!0),className:"bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600",children:"Create Group"})]})]}),N&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat(N.includes("Error")?"bg-red-50 text-red-700":"bg-green-50 text-green-700"),children:N}),m&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Create New Group"}),(0,s.jsxs)("form",{onSubmit:createGroup,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Name"}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"e.g., Smith Family",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optional)"}),(0,s.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Family competition for daily Wordle",rows:3})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{type:"submit",className:"flex-1 bg-primary-500 text-white py-2 rounded-lg hover:bg-primary-600",children:"Create"}),(0,s.jsx)("button",{type:"button",onClick:()=>x(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})]})}),g&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Join Group"}),(0,s.jsxs)("form",{onSubmit:joinGroup,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invite Code"}),(0,s.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 font-mono text-center",placeholder:"ABCD12",maxLength:6,required:!0}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the 6-character code from your family admin"})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{type:"submit",className:"flex-1 bg-primary-500 text-white py-2 rounded-lg hover:bg-primary-600",children:"Join"}),(0,s.jsx)("button",{type:"button",onClick:()=>h(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})]})}),0===i.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC65"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No groups yet"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Create a new group or join an existing one to get started"})]}):(0,s.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-4",children:[(0,s.jsxs)("span",{children:[e.member_count," members"]}),(0,s.jsxs)("span",{children:["Code: ",e.invite_code]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n(),{href:"/groups/".concat(e.id),className:"block w-full text-center bg-primary-500 text-white py-2 rounded-lg hover:bg-primary-600",children:"View Group"}),(0,s.jsx)(n(),{href:"/leaderboard?group=".concat(e.id),className:"block w-full text-center bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200",children:"Leaderboard"})]})]},e.id))}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsx)(n(),{href:"/",className:"text-primary-500 hover:text-primary-600",children:"← Back to Home"})})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in"}),(0,s.jsx)(n(),{href:"/auth/login",className:"bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600",children:"Sign In"})]})})}},1344:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var s=r(7437),a=r(2265),i=r(2899);let n=(0,a.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{x(!0)},[]),(0,a.useEffect)(()=>{if(!m)return;i.OQ.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;c(r),l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),u(!1)});let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,t)=>{var r;c(t),l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),u(!1)}),t=setInterval(async()=>{let e=await (0,i.eR)();e.isValid&&e.timeUntilExpiry<216e5&&await (0,i.dx)()},432e5);return()=>{e.unsubscribe(),clearInterval(t)}},[m]);let signOut=async()=>{try{await i.OQ.auth.signOut()}catch(e){}};return m?(0,s.jsx)(n.Provider,{value:{user:r,session:o,loading:d,signOut},children:t}):(0,s.jsx)("div",{className:"min-h-screen bg-blue-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl text-gray-600",children:"Loading..."})})}let useAuth=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2899:function(e,t,r){"use strict";r.d(t,{OQ:function(){return l},dx:function(){return refreshSession},eR:function(){return getSessionStatus}});var s=r(2362),a=r(2601);let i=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://xneavnttdgrpltmmldit.supabase.co",n=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZWF2bnR0ZGdycGx0bW1sZGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTk3ODksImV4cCI6MjA2NTIzNTc4OX0.2T3VMVWWn7g-m8iYcoHq8r5ZkM8rWtLEZ2RXWttw3AA";if(!i||!n)throw Error("Missing Supabase environment variables");let l=(0,s.eI)(i,n,{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"wordle-golf-session",flowType:"pkce"},global:{headers:{"X-Client-Info":"wordle-golf-tracker"}}}),refreshSession=async()=>{try{let{data:e,error:t}=await l.auth.refreshSession();if(t)return!1;return!0}catch(e){return!1}},getSessionStatus=async()=>{try{let{data:{session:e}}=await l.auth.getSession();return{isValid:!!e,expiresAt:null==e?void 0:e.expires_at,refreshToken:null==e?void 0:e.refresh_token,timeUntilExpiry:(null==e?void 0:e.expires_at)?1e3*e.expires_at-Date.now():0}}catch(e){return{isValid:!1,expiresAt:null,refreshToken:null,timeUntilExpiry:0}}}},1396:function(e,t,r){e.exports=r(8326)}},function(e){e.O(0,[553,326,971,472,744],function(){return e(e.s=4192)}),_N_E=e.O()}]);