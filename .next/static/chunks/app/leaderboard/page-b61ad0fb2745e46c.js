(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{4232:function(e,t,r){Promise.resolve().then(r.bind(r,8392))},8392:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return LeaderboardPage}});var a=r(7437),s=r(2265),l=r(1396),n=r.n(l),i=r(1344),o=r(2899);function LeaderboardPage(){let{user:e,loading:t}=(0,i.useAuth)(),[r,l]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]),[u,m]=(0,s.useState)([]),[x,h]=(0,s.useState)(""),[g,p]=(0,s.useState)("net"),[f,v]=(0,s.useState)("");(0,s.useEffect)(()=>{e&&fetchUserGroups()},[e]),(0,s.useEffect)(()=>{x&&fetchLeaderboard()},[x,g]);let fetchUserGroups=async()=>{try{let{data:t,error:r}=await o.O.from("group_members").select("groups(*)").eq("user_id",null==e?void 0:e.id);if(r)throw r;let a=t.map(e=>e.groups).filter(Boolean);m(a),1===a.length&&h(a[0].id)}catch(e){console.error("Error fetching groups:",e)}},fetchLeaderboard=async()=>{if(x){l(!0);try{let e=new Date,t=e.toISOString().slice(0,7),{data:r,error:a}=await o.O.from("scores").select("\n          *,\n          profiles (display_name, email)\n        ").eq("group_id",x).gte("puzzle_date","".concat(t,"-01")).lt("puzzle_date","".concat(t,"-32")).order("puzzle_date",{ascending:!0});if(a)throw a;let{data:s,error:l}=await o.O.from("handicaps").select("*").eq("group_id",x);if(l)throw l;let n=new Map;null==r||r.forEach(e=>{var t,r,a,l;let i=e.user_id,o=(null===(t=e.profiles)||void 0===t?void 0:t.display_name)||(null===(r=e.profiles)||void 0===r?void 0:r.email)||"Unknown";if(!n.has(i)){let e=(null==s?void 0:null===(l=s.find(e=>e.user_id===i))||void 0===l?void 0:l.current_handicap)||0;n.set(i,{userId:i,name:o,totalRaw:0,totalNet:0,gamesPlayed:0,handicap:e,scores:[]})}let c=n.get(i),d=(null==s?void 0:null===(a=s.find(e=>e.user_id===i))||void 0===a?void 0:a.current_handicap)||0;c.totalRaw+=e.raw_score,c.totalNet+=Math.max(-3,e.raw_score-d),c.gamesPlayed+=1,c.scores.push({date:e.puzzle_date,raw:e.raw_score,golf_score:e.golf_score,attempts:e.attempts})});let i=Array.from(n.values()).filter(e=>e.gamesPlayed>0).map(e=>({...e,avgRaw:e.totalRaw/e.gamesPlayed,avgNet:e.totalNet/e.gamesPlayed})).sort((e,t)=>"net"===g?e.avgNet-t.avgNet:e.avgRaw-t.avgRaw);d(i)}catch(e){v("Error loading leaderboard: ".concat(e.message))}finally{l(!1)}}},formatScore=e=>0===e?"E":e>0?"+".concat(e.toFixed(1)):e.toFixed(1);return t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Leaderboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Current month rankings"})]}),f&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-lg bg-red-50 text-red-700 text-center",children:f}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[u.length>1&&(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Group"}),(0,a.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[(0,a.jsx)("option",{value:"",children:"Choose a group..."}),u.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"View Type"}),(0,a.jsxs)("div",{className:"flex rounded-lg border border-gray-300 overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>p("net"),className:"flex-1 px-4 py-2 text-sm font-medium ".concat("net"===g?"bg-primary-500 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Net Scores"}),(0,a.jsx)("button",{onClick:()=>p("raw"),className:"flex-1 px-4 py-2 text-sm font-medium ".concat("raw"===g?"bg-primary-500 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Raw Scores"})]})]})]}),r?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading leaderboard..."})]}):x?0===c.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFCC️"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No scores yet"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Be the first to submit a score this month!"}),(0,a.jsx)(n(),{href:"/submit",className:"bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600",children:"Submit Score"})]}):(0,a.jsx)("div",{className:"space-y-4",children:c.map((t,r)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border ".concat(t.userId===(null==e?void 0:e.id)?"border-primary-300 bg-primary-50":"border-gray-200 bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ".concat(0===r?"bg-yellow-400 text-yellow-900":1===r?"bg-gray-300 text-gray-700":2===r?"bg-orange-400 text-orange-900":"bg-gray-200 text-gray-600"),children:r+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:t.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[t.gamesPlayed," game",1!==t.gamesPlayed?"s":""," played","net"===g&&" • ".concat(t.handicap.toFixed(1)," handicap")]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:formatScore("net"===g?t.avgNet:t.avgRaw)}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"net"===g?"Net Average":"Raw Average"})]})]},t.userId))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Please select a group to view the leaderboard"})})]}),(0,a.jsxs)("div",{className:"text-center space-x-4",children:[(0,a.jsx)(n(),{href:"/groups",className:"text-primary-500 hover:text-primary-600",children:"← Back to Groups"}),(0,a.jsx)(n(),{href:"/submit",className:"text-primary-500 hover:text-primary-600",children:"Submit Score →"})]})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in"}),(0,a.jsx)(n(),{href:"/auth/login",className:"bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600",children:"Sign In"})]})})}},1344:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var a=r(7437),s=r(2265),l=r(2899);let n=(0,s.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0);(0,s.useEffect)(()=>{l.O.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;c(r),i(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),u(!1)});let{data:{subscription:e}}=l.O.auth.onAuthStateChange(async(e,t)=>{var r;c(t),i(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),u(!1)});return()=>e.unsubscribe()},[]);let signOut=async()=>{try{await l.O.auth.signOut()}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)(n.Provider,{value:{user:r,session:o,loading:d,signOut},children:t})}let useAuth=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2899:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var a=r(2362),s=r(2601);let l=s.env.NEXT_PUBLIC_SUPABASE_URL||"https://xneavnttdgrpltmmldit.supabase.co",n=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZWF2bnR0ZGdycGx0bW1sZGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTk3ODksImV4cCI6MjA2NTIzNTc4OX0.2T3VMVWWn7g-m8iYcoHq8r5ZkM8rWtLEZ2RXWttw3AA";if(!l||!n)throw Error("Missing Supabase environment variables");let i=(0,a.eI)(l,n,{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},1396:function(e,t,r){e.exports=r(8326)}},function(e){e.O(0,[553,326,971,472,744],function(){return e(e.s=4232)}),_N_E=e.O()}]);