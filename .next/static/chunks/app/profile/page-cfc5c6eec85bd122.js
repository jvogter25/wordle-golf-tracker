(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{7699:function(e,t,r){Promise.resolve().then(r.bind(r,8166))},8166:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ProfilePage}});var a=r(7437),i=r(2265),s=r(1396),l=r.n(s),n=r(1344),o=r(2899);function ProfilePage(){let{user:e,loading:t}=(0,n.useAuth)(),[r,s]=(0,i.useState)(null),[c,u]=(0,i.useState)(!0),[d,m]=(0,i.useState)(!1),[f,h]=(0,i.useState)(!1),[g,p]=(0,i.useState)(""),[x,y]=(0,i.useState)(""),v=(0,i.useRef)(null);(0,i.useEffect)(()=>{e&&fetchProfile()},[e]);let fetchProfile=async()=>{try{let{data:t,error:r}=await o.OQ.from("profiles").select("*").eq("id",null==e?void 0:e.id).single();if(r&&"PGRST116"!==r.code)throw r;t&&(s(t),p(t.display_name||""))}catch(e){y("Error loading profile: ".concat(e.message))}finally{u(!1)}},updateProfile=async t=>{if(t.preventDefault(),!g.trim()){y("Display name is required");return}m(!0);try{let{error:t}=await o.OQ.from("profiles").upsert({id:null==e?void 0:e.id,email:null==e?void 0:e.email,display_name:g.trim(),updated_at:new Date().toISOString()});if(t)throw t;y("Profile updated successfully!"),await fetchProfile()}catch(e){y("Error updating profile: ".concat(e.message))}finally{m(!1)}},uploadAvatar=async t=>{try{if(h(!0),y(""),!t.target.files||0===t.target.files.length)throw Error("You must select an image to upload.");let r=t.target.files[0];if(!r.type.startsWith("image/"))throw Error("Please select an image file.");if(r.size>2097152)throw Error("Image must be less than 2MB.");let a=r.name.split(".").pop(),i="".concat(null==e?void 0:e.id,"-").concat(Math.random(),".").concat(a),s="avatars/".concat(i),{error:l}=await o.OQ.storage.from("avatars").upload(s,r);if(l)throw l;let{data:n}=o.OQ.storage.from("avatars").getPublicUrl(s),{error:c}=await o.OQ.from("profiles").update({avatar_url:n.publicUrl,updated_at:new Date().toISOString()}).eq("id",null==e?void 0:e.id);if(c)throw c;y("Profile picture updated successfully!"),await fetchProfile()}catch(e){y("Error uploading image: ".concat(e.message))}finally{h(!1)}},removeAvatar=async()=>{if(confirm("Are you sure you want to remove your profile picture?"))try{h(!0);let{error:t}=await o.OQ.from("profiles").update({avatar_url:null,updated_at:new Date().toISOString()}).eq("id",null==e?void 0:e.id);if(t)throw t;y("Profile picture removed successfully!"),await fetchProfile()}catch(e){y("Error removing image: ".concat(e.message))}finally{h(!1)}};return t||c?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading profile..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Profile Settings"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage your profile information"})]}),x&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-lg text-center ".concat(x.includes("Error")?"bg-red-50 text-red-700":"bg-green-50 text-green-700"),children:x}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsx)("div",{className:"mb-4",children:(null==r?void 0:r.avatar_url)?(0,a.jsx)("img",{src:r.avatar_url,alt:"Profile",className:"w-24 h-24 rounded-full mx-auto object-cover border-4 border-gray-200"}):(0,a.jsx)("div",{className:"w-24 h-24 rounded-full mx-auto bg-primary-500 flex items-center justify-center text-white text-2xl font-bold border-4 border-gray-200",children:(g||(null==r?void 0:r.email)||"U")[0].toUpperCase()})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{type:"file",ref:v,accept:"image/*",onChange:uploadAvatar,className:"hidden"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},disabled:f,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 mr-2",children:f?"Uploading...":"Upload Picture"}),(null==r?void 0:r.avatar_url)&&(0,a.jsx)("button",{onClick:removeAvatar,disabled:f,className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 disabled:opacity-50",children:"Remove Picture"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Upload a profile picture (max 2MB). JPG, PNG, or GIF."})]}),(0,a.jsxs)("form",{onSubmit:updateProfile,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:e.email||"",disabled:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"Enter your display name",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"This name will be displayed on leaderboards and in groups"})]}),(0,a.jsx)("button",{type:"submit",disabled:d||!g.trim(),className:"w-full bg-primary-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-primary-600 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Saving...":"Save Profile"})]})]}),(0,a.jsx)("div",{className:"mt-8 text-center",children:(0,a.jsx)(l(),{href:"/",className:"text-primary-500 hover:text-primary-600",children:"â† Back to Home"})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in"}),(0,a.jsx)(l(),{href:"/auth/login",className:"bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600",children:"Sign In"})]})})}},1344:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var a=r(7437),i=r(2265),s=r(2899);let l=(0,i.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[r,n]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(!0),[m,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{f(!0)},[]),(0,i.useEffect)(()=>{if(!m)return;s.OQ.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;c(r),n(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),d(!1)});let{data:{subscription:e}}=s.OQ.auth.onAuthStateChange(async(e,t)=>{var r;c(t),n(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),d(!1)}),t=setInterval(async()=>{let e=await (0,s.eR)();e.isValid&&e.timeUntilExpiry<216e5&&await (0,s.dx)()},432e5);return()=>{e.unsubscribe(),clearInterval(t)}},[m]);let signOut=async()=>{try{await s.OQ.auth.signOut()}catch(e){}};return m?(0,a.jsx)(l.Provider,{value:{user:r,session:o,loading:u,signOut},children:t}):(0,a.jsx)("div",{className:"min-h-screen bg-blue-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xl text-gray-600",children:"Loading..."})})}let useAuth=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2899:function(e,t,r){"use strict";r.d(t,{OQ:function(){return n},dx:function(){return refreshSession},eR:function(){return getSessionStatus}});var a=r(2362),i=r(2601);let s=i.env.NEXT_PUBLIC_SUPABASE_URL||"https://xneavnttdgrpltmmldit.supabase.co",l=i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZWF2bnR0ZGdycGx0bW1sZGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTk3ODksImV4cCI6MjA2NTIzNTc4OX0.2T3VMVWWn7g-m8iYcoHq8r5ZkM8rWtLEZ2RXWttw3AA";if(!s||!l)throw Error("Missing Supabase environment variables");let n=(0,a.eI)(s,l,{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"wordle-golf-session",flowType:"pkce"},global:{headers:{"X-Client-Info":"wordle-golf-tracker"}}}),refreshSession=async()=>{try{let{data:e,error:t}=await n.auth.refreshSession();if(t)return!1;return!0}catch(e){return!1}},getSessionStatus=async()=>{try{let{data:{session:e}}=await n.auth.getSession();return{isValid:!!e,expiresAt:null==e?void 0:e.expires_at,refreshToken:null==e?void 0:e.refresh_token,timeUntilExpiry:(null==e?void 0:e.expires_at)?1e3*e.expires_at-Date.now():0}}catch(e){return{isValid:!1,expiresAt:null,refreshToken:null,timeUntilExpiry:0}}}},1396:function(e,t,r){e.exports=r(8326)}},function(e){e.O(0,[553,326,971,472,744],function(){return e(e.s=7699)}),_N_E=e.O()}]);